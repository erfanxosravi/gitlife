<!DOCTYPE html>
<html lang="fa-IR" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ø²Ù†Ø¯Ú¯ÛŒ</title>
    <style>
        :root {
            --bg-color: #f0f4f8;
            --text-color: #1e293b;
            --primary-color: #3b82f6;
            --secondary-color: #10b981;
            --card-bg-color: #ffffff;
            --border-color: #e2e8f0;
        }

        html.dark {
            --bg-color: #0f172a;
            --text-color: #e2e8f0;
            --card-bg-color: #1e293b;
            --border-color: #334155;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        #app {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .hidden { display: none !important; }

        /* --- Screens --- */
        #start-screen, #game-over-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 2rem;
            flex-grow: 1;
        }

        #game-screen {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        /* --- Layout --- */
        #header {
            background-color: var(--card-bg-color);
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #main-content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem;
        }
        #footer {
            background-color: var(--card-bg-color);
            border-top: 1px solid var(--border-color);
        }

        /* --- Components --- */
        #stats-panel {
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .progress-bar {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .progress-bar .label {
            width: 5rem;
            font-weight: bold;
        }
        .progress-bar .bar {
            flex-grow: 1;
            background-color: #e5e7eb;
            border-radius: 99px;
            height: 20px;
        }
        .progress-bar .fill {
            background-color: var(--secondary-color);
            height: 100%;
            border-radius: 99px;
            text-align: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
            line-height: 20px;
        }

        #action-bar {
            display: flex;
            justify-content: space-around;
            padding: 0.5rem;
            background-color: var(--primary-color);
            color: white;
        }

        button, .button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
            text-align: center;
            display: inline-block;
            margin-top: 0.5rem;
        }
        button:hover, .button:hover {
            background-color: #2563eb;
        }
        button.secondary, .button.secondary {
            background-color: var(--secondary-color);
        }
        button.secondary:hover, .button.secondary:hover {
            background-color: #059669;
        }
        button:disabled, .button:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
        }

        /* --- Modal --- */
        #modal-container {
            position: fixed;
            inset: 0;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #modal-content {
            background-color: var(--card-bg-color);
            padding: 1.5rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-item {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Start Screen -->
        <div id="start-screen">
            <h1>Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ø²Ù†Ø¯Ú¯ÛŒ</h1>
            <p>ÛŒÚ© Ø²Ù†Ø¯Ú¯ÛŒ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ø´Ø±ÙˆØ¹ Ú©Ù†...</p>
            <button id="new-game-button">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ Ø¬Ø¯ÛŒØ¯</button>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="hidden">
            <header id="header">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h2 id="player-name">Ù†Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù†</h2>
                        <p id="player-status">ÙˆØ¶Ø¹ÛŒØª</p>
                    </div>
                    <div style="text-align: right;">
                        <h2 id="player-money" style="color: var(--secondary-color);">$0</h2>
                        <p>Ù…ÙˆØ¬ÙˆØ¯ÛŒ</p>
                    </div>
                </div>
            </header>
            <main id="main-content">
                <!-- Log entries will be added here -->
            </main>
            <footer id="footer">
                <div id="action-bar">
                    <button id="career-button">Ø­Ø±ÙÙ‡</button>
                    <button id="next-year-button" class="secondary">Ø³Ø§Ù„ Ø¨Ø¹Ø¯</button>
                </div>
                <div id="stats-panel">
                    <!-- Progress bars will be rendered here -->
                </div>
            </footer>
        </div>

        <!-- Game Over Screen -->
        <div id="game-over-screen" class="hidden">
            <h1>Ø¨Ø§Ø²ÛŒ ØªÙ…Ø§Ù… Ø´Ø¯</h1>
            <p id="death-reason">Ø¯Ù„ÛŒÙ„ Ù…Ø±Ú¯...</p>
            <button id="restart-button">Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯</button>
        </div>

        <!-- Modal -->
        <div id="modal-container" class="hidden">
            <div id="modal-content">
                <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; margin-bottom: 1rem;">
                    <h3 id="modal-title">Ø¹Ù†ÙˆØ§Ù† Ù…ÙˆØ¯Ø§Ù„</h3>
                    <button id="modal-close-button" style="background: none; color: var(--text-color); font-size: 24px; padding: 0;">&times;</button>
                </div>
                <div id="modal-body">
                    <!-- Modal content goes here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- GAME LOGIC (from previous step) ---
        const getRandom = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
        const clamp = (num, min, max) => Math.min(Math.max(num, min), max);
        const COUNTRIES = [{ name: "Ø§ÛŒØ±Ø§Ù†", flag: "ğŸ‡®ğŸ‡·" }, { name: "Ø¢Ù…Ø±ÛŒÚ©Ø§", flag: "ğŸ‡ºğŸ‡¸" }];
        const CITIES = { "Ø§ÛŒØ±Ø§Ù†": ["ØªÙ‡Ø±Ø§Ù†", "Ø§ØµÙÙ‡Ø§Ù†"], "Ø¢Ù…Ø±ÛŒÚ©Ø§": ["Ù†ÛŒÙˆÛŒÙˆØ±Ú©", "Ù„Ø³ Ø¢Ù†Ø¬Ù„Ø³"] };
        const SKILLS_DATA = [{ id: 'acting', name: 'Ø¨Ø§Ø²ÛŒÚ¯Ø±ÛŒ', cost: 1200, description: 'ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ ÙÙ†ÙˆÙ† Ø¨Ø§Ø²ÛŒÚ¯Ø±ÛŒ.' }];
        const DIRECTORS = [{ id: 1, name: "Ø§ØµØºØ± ÙØ±Ù‡Ø§Ø¯ÛŒ", fame: 95 }, { id: 2, name: "Christopher Nolan", fame: 98 }];
        const generateMovieTitle = () => `ÙÛŒÙ„Ù… ${getRandom(100, 999)}`;
        const FIRST_NAMES_MALE = ["Ø§Ù…ÛŒØ±", "Ú©ÛŒØ§Ù†"];
        const FIRST_NAMES_FEMALE = ["Ø³Ø§Ø±Ø§", "Ø¢ÙˆØ§"];
        const LAST_NAMES = ["Ø±Ø¶Ø§ÛŒÛŒ", "Ù…Ø­Ù…Ø¯ÛŒ"];
        function createNewPlayer(config = {}) { const gender = config.gender || (Math.random() > 0.5 ? 'Ù…Ø±Ø¯' : 'Ø²Ù†'); const name = config.name || (gender === 'Ù…Ø±Ø¯' ? FIRST_NAMES_MALE[getRandom(0, FIRST_NAMES_MALE.length - 1)] : FIRST_NAMES_FEMALE[getRandom(0, FIRST_NAMES_FEMALE.length - 1)]) + ' ' + LAST_NAMES[getRandom(0, LAST_NAMES.length-1)]; const countryData = COUNTRIES[getRandom(0, COUNTRIES.length - 1)]; return { name, gender, age: 0, country: countryData.name, countryFlag: countryData.flag, city: CITIES[countryData.name][0], money: 500, health: 100, happiness: 80, intelligence: getRandom(50, 100), looks: getRandom(30, 100), popularity: 0, job: null, educationStatus: { stage: 'Ø¨ÛŒÚ©Ø§Ø±' }, alive: true, skills: {}, activeActingProject: null, completedActingProjects: [] }; }
        function advanceYear(player) { let newPlayerState = { ...player, age: player.age + 1 }; const log = [`${newPlayerState.age} Ø³Ø§Ù„Ù‡ Ø´Ø¯ÛŒ.`]; if (newPlayerState.activeActingProject) { const project = newPlayerState.activeActingProject; log.push(`ÛŒÚ© Ø³Ø§Ù„ Ø¯ÛŒÚ¯Ø± Ø¯Ø± Ù¾Ø±ÙˆÚ˜Ù‡ "${project.name}" Ø³Ù¾Ø±ÛŒ Ø´Ø¯.`); project.yearsLeft--; newPlayerState.skills.acting = clamp((newPlayerState.skills.acting || 0) + getRandom(2, 5), 0, 100); if (project.yearsLeft <= 0) { log.push(`ÙÛŒÙ„Ù…â€ŒØ¨Ø±Ø¯Ø§Ø±ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡ "${project.name}" Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯!`); const rating = (project.storyQuality * 0.4) + (project.director.fame * 0.3) + (project.playerPerformance * 0.3); project.finalRating = clamp(Math.round(rating), 0, 100); const income = Math.round((project.budget / 100) * (project.finalRating / 10)); const popularityGain = Math.round(project.finalRating / 5); newPlayerState.money += income; newPlayerState.popularity = clamp(newPlayerState.popularity + popularityGain, 0, 100); log.push(`Ø§ÛŒÙ† ÙÛŒÙ„Ù… Ø§Ù…ØªÛŒØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ ${project.finalRating} Ø±Ø§ Ú©Ø³Ø¨ Ú©Ø±Ø¯ Ùˆ Ø´Ù…Ø§ ${income.toLocaleString()} ØªÙˆÙ…Ø§Ù† Ø¯Ø±Ø¢Ù…Ø¯ Ø¯Ø§Ø´ØªÛŒØ¯.`); newPlayerState.completedActingProjects.push(project); newPlayerState.activeActingProject = null; } } if (newPlayerState.health <= 0) { newPlayerState.alive = false; log.push("Ø¹Ù…Ø±Øª Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯."); } return { newPlayerState, log }; }
        function getAvailableAuditions(player) { if (player.activeActingProject) return []; const auditions = []; for (let i = 0; i < 3; i++) { const director = DIRECTORS[getRandom(0, DIRECTORS.length - 1)]; const role = ['Ø§ØµÙ„ÛŒ', 'Ù…Ú©Ù…Ù„', 'Ø³ÛŒØ§Ù‡ÛŒ Ù„Ø´Ú©Ø±'][getRandom(0,2)]; auditions.push({ id: `proj_${Date.now()}_${i}`, name: generateMovieTitle(), type: 'Ø³ÛŒÙ†Ù…Ø§', role, director, budget: getRandom(100000, 5000000), storyQuality: getRandom(30, 90), duration: getRandom(1,3), yearsLeft: 0, playerPerformance: 0, finalRating: 0, }); } return auditions; }
        function auditionForProject(player, project) { if (player.job || player.activeActingProject) return { player, message: "Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¯Ø± ØªØ³Øª Ø¨Ø§Ø²ÛŒÚ¯Ø±ÛŒ Ø´Ø±Ú©Øª Ú©Ù†ÛŒØ¯."}; const actingSkill = player.skills['acting'] || 0; const successChance = (actingSkill * 0.4) + (player.looks * 0.2) + (player.popularity * 0.1); let requiredScore = 50; if (project.role === 'Ù…Ú©Ù…Ù„') requiredScore = 65; if (project.role === 'Ø§ØµÙ„ÛŒ') requiredScore = 80; if (successChance >= requiredScore) { const newProject = { ...project, yearsLeft: project.duration, playerPerformance: 50 }; const newPlayer = { ...player, activeActingProject: newProject }; return { player: newPlayer, message: `Ø´Ù…Ø§ Ù†Ù‚Ø´ ${project.role} Ø±Ø§ Ø¯Ø± ÙÛŒÙ„Ù… "${project.name}" Ø¨Ù‡ Ø¯Ø³Øª Ø¢ÙˆØ±Ø¯ÛŒØ¯.` }; } else { const newPlayer = {...player, happiness: clamp(player.happiness - 5, 0, 100)}; return { player: newPlayer, message: `Ø¯Ø± ØªØ³Øª Ø¨Ø§Ø²ÛŒÚ¯Ø±ÛŒ Ø±Ø¯ Ø´Ø¯ÛŒØ¯.` }; } }
        function practiceRole(player) { if (!player.activeActingProject) return { player, message: "Ø´Ù…Ø§ Ø¯Ø± Ù¾Ø±ÙˆÚ˜Ù‡â€ŒØ§ÛŒ ÙØ¹Ø§Ù„ Ù†ÛŒØ³ØªÛŒØ¯." }; const performanceGain = getRandom(5, 15); player.activeActingProject.playerPerformance = clamp(player.activeActingProject.playerPerformance + performanceGain, 0, 100); player.skills.acting = clamp((player.skills.acting || 0) + 1, 0, 100); return { player, message: `Ø¹Ù…Ù„Ú©Ø±Ø¯Øª ${performanceGain} ÙˆØ§Ø­Ø¯ Ø¨Ù‡ØªØ± Ø´Ø¯.` }; }
        function learnSkill(player, skillId) { const skillData = SKILLS_DATA.find(s => s.id === skillId); if (!skillData || player.money < skillData.cost) return { player, message: "Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ù†Ø¯Ø§Ø±ÛŒ."}; player.money -= skillData.cost; player.skills[skillId] = clamp((player.skills[skillId] || 0) + getRandom(10, 20), 0, 100); return { player, message: `Ø¯Ø± Ø¯ÙˆØ±Ù‡ ${skillData.name} Ø´Ø±Ú©Øª Ú©Ø±Ø¯ÛŒ.`}; }

        // --- UI & APP LOGIC ---
        let gameState = { player: null, history: {}, stage: 'start' };

        const ui = {
            startScreen: document.getElementById('start-screen'),
            gameScreen: document.getElementById('game-screen'),
            gameOverScreen: document.getElementById('game-over-screen'),
            modalContainer: document.getElementById('modal-container'),
            modalTitle: document.getElementById('modal-title'),
            modalBody: document.getElementById('modal-body'),
            playerName: document.getElementById('player-name'),
            playerStatus: document.getElementById('player-status'),
            playerMoney: document.getElementById('player-money'),
            statsPanel: document.getElementById('stats-panel'),
            mainLog: document.getElementById('main-content'),
            deathReason: document.getElementById('death-reason'),
        };

        function renderProgressBar(label, value) { return `<div class="progress-bar"><span class="label">${label}</span><div class="bar"><div class="fill" style="width: ${value}%;">${value > 10 ? value+'%' : ''}</div></div></div>`; }
        function renderStatsPanel() { let html = renderProgressBar('Ø´Ø§Ø¯ÛŒ', gameState.player.happiness) + renderProgressBar('Ø³Ù„Ø§Ù…ØªÛŒ', gameState.player.health) + renderProgressBar('Ù‡ÙˆØ´', gameState.player.intelligence) + renderProgressBar('Ø²ÛŒØ¨Ø§ÛŒÛŒ', gameState.player.looks); if (gameState.player.popularity > 0) { html += renderProgressBar('Ù…Ø­Ø¨ÙˆØ¨ÛŒØª', gameState.player.popularity); } ui.statsPanel.innerHTML = html; }
        function renderHeader() { ui.playerName.innerText = `${gameState.player.name} ${gameState.player.countryFlag}`; ui.playerMoney.innerText = `$${gameState.player.money.toLocaleString()}`; ui.playerStatus.innerText = gameState.player.job ? gameState.player.job.title : gameState.player.educationStatus.stage; }
        function renderLog() { ui.mainLog.innerHTML = ''; const sortedAges = Object.keys(gameState.history).map(Number).sort((a, b) => a - b); sortedAges.forEach(age => { const ageDiv = document.createElement('div'); ageDiv.innerHTML = `<h3>Ø³Ù†: ${age}</h3>`; const list = document.createElement('ul'); gameState.history[age].forEach(event => { const item = document.createElement('li'); item.innerText = event; list.appendChild(item); }); ageDiv.appendChild(list); ui.mainLog.appendChild(ageDiv); }); ui.mainLog.scrollTop = ui.mainLog.scrollHeight; }
        function renderModal(title, contentHTML) { ui.modalTitle.innerText = title; ui.modalBody.innerHTML = contentHTML; ui.modalContainer.classList.remove('hidden'); }
        function closeModal() { ui.modalContainer.classList.add('hidden'); }

        function render() {
            ui.startScreen.classList.toggle('hidden', gameState.stage !== 'start');
            ui.gameScreen.classList.toggle('hidden', gameState.stage !== 'playing');
            ui.gameOverScreen.classList.toggle('hidden', gameState.stage !== 'game_over');
            if (gameState.stage === 'playing') { renderHeader(); renderStatsPanel(); renderLog(); }
            else if (gameState.stage === 'game_over') { ui.deathReason.innerText = gameState.history[gameState.player.age].slice(-1)[0]; }
        }

        function handleActionResult({ player, message }) {
            gameState.player = player;
            if (message) {
                const age = gameState.player.age;
                if (!gameState.history[age]) gameState.history[age] = [];
                gameState.history[age].push(message);
            }
            render();
            closeModal();
        }

        function showCareerModal() {
            let content = `<div><button class="button" id="acting-career-button">Ø¨Ø§Ø²ÛŒÚ¯Ø±ÛŒ</button></div>`;
            renderModal('Ø­Ø±ÙÙ‡', content);
            document.getElementById('acting-career-button').addEventListener('click', showActingModal);
        }

        function showActingModal() {
            const player = gameState.player;
            let content = '';
            if (player.activeActingProject) {
                const project = player.activeActingProject;
                content = `
                    <h3>Ù¾Ø±ÙˆÚ˜Ù‡ ÙØ¹Ù„ÛŒ: ${project.name} (${project.role})</h3>
                    <p>Ø²Ù…Ø§Ù† Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ${project.yearsLeft} Ø³Ø§Ù„</p>
                    ${renderProgressBar('Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø´Ù…Ø§', project.playerPerformance)}
                    <button class="button" id="practice-role-button">ØªÙ…Ø±ÛŒÙ† Ù†Ù‚Ø´</button>
                `;
            } else {
                content = `<h3>ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒÚ¯Ø±ÛŒ</h3>`;
                const auditions = getAvailableAuditions(player);
                if (auditions.length === 0) {
                    content += '<p>ØªØ³ØªÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</p>';
                } else {
                    auditions.forEach(project => {
                        content += `
                            <div class="modal-item">
                                <strong>${project.name}</strong> (Ù†Ù‚Ø´: ${project.role})
                                <button class="button" data-project-id='${project.id}'>ØªØ³Øª Ø¨Ø¯Ù‡</button>
                            </div>
                        `;
                    });
                }
            }
            renderModal('Ø­Ø±ÙÙ‡ Ø¨Ø§Ø²ÛŒÚ¯Ø±ÛŒ', content);
        }

        function init() {
            document.getElementById('new-game-button').addEventListener('click', () => {
                gameState.player = createNewPlayer();
                gameState.stage = 'playing';
                gameState.history = { 0: [`ØªÙˆÙ„Ø¯Øª Ù…Ø¨Ø§Ø±Ú©ØŒ ${gameState.player.name}!`] };
                render();
            });

            document.getElementById('next-year-button').addEventListener('click', () => {
                const { newPlayerState, log } = advanceYear(gameState.player);
                gameState.player = newPlayerState;
                const age = gameState.player.age;
                if (!gameState.history[age]) gameState.history[age] = [];
                gameState.history[age].push(...log);
                if (!gameState.player.alive) gameState.stage = 'game_over';
                render();
            });

            document.getElementById('restart-button').addEventListener('click', () => {
                gameState.stage = 'start';
                render();
            });

            document.getElementById('career-button').addEventListener('click', showCareerModal);
            document.getElementById('modal-close-button').addEventListener('click', closeModal);

            ui.modalBody.addEventListener('click', e => {
                if (e.target.id === 'practice-role-button') {
                    handleActionResult(practiceRole(gameState.player));
                }
                if (e.target.matches('[data-project-id]')) {
                    const projectId = e.target.dataset.projectId;
                    const project = getAvailableAuditions(gameState.player).find(p => p.id === projectId);
                    if(project) handleActionResult(auditionForProject(gameState.player, project));
                }
            });
            render();
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
